<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>更多视频 - 酷哩酷哩 (゜-゜)つロ 干杯~-kilikili</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", "Segoe UI", sans-serif;
        }
        
        body {
            background-color: #f4f4f4;
            color: #333;
        }
        
        /* 顶部导航栏 */
        .header {
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            padding: 12px 0;
        }
        
        .logo {
            display: flex;
            align-items: center;
            margin-right: 20px;
        }
        
        .logo span {
            color: #FB7299;
            font-size: 20px;
            font-weight: bold;
            margin-left: 5px;
        }
        
        /* 音频波形样式 */
        .audio-wave {
            display: flex;
            align-items: flex-end;
            gap: 3px;
            height: 36px;
            margin-right: 5px;
        }
        
        .wave-bar {
            width: 4px;
            background: #FB7299;
            border-radius: 2px;
            animation: waveAnimation 1.2s ease-in-out infinite;
        }
        
        .wave-bar:nth-child(1) {
            height: 20px;
            animation-delay: 0s;
        }
        
        .wave-bar:nth-child(2) {
            height: 28px;
            animation-delay: 0.2s;
        }
        
        .wave-bar:nth-child(3) {
            height: 16px;
            animation-delay: 0.4s;
        }
        
        .wave-bar:nth-child(4) {
            height: 32px;
            animation-delay: 0.6s;
        }
        
        @keyframes waveAnimation {
            0%, 100% {
                transform: scaleY(1);
                opacity: 0.8;
            }
            50% {
                transform: scaleY(1.5);
                opacity: 1;
            }
        }
        
        .main-nav {
            display: flex;
            flex: 1;
        }
        
        .main-nav a {
            padding: 8px 16px;
            text-decoration: none;
            color: #505050;
            font-size: 14px;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .main-nav a:hover {
            color: #FB7299;
            transform: translateY(-2px);
        }
        
        .main-nav a.active {
            color: #FB7299;
        }
        
        .main-nav a.active::after {
            content: '';
            position: absolute;
            bottom: -12px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid #FB7299;
            animation: slideIn 0.3s ease-out forwards;
        }
        
        @keyframes slideIn {
            from {
                width: 0;
                opacity: 0;
            }
            to {
                width: 12px;
                opacity: 1;
            }
        }
        
        .search-box {
            display: flex;
            align-items: center;
            background: #f4f4f4;
            border-radius: 8px;
            padding: 8px 12px;
            margin: 0 15px;
            width: 300px;
        }
        
        .search-box input {
            border: none;
            background: transparent;
            outline: none;
            width: 100%;
            padding: 0 8px;
        }
        
        .search-box i {
            color: #999;
        }
        
        .search-btn {
            background: #FB7299;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 8px;
        }
        
        .search-btn:hover {
            background: #e65a7f;
        }
        
        .user-actions {
            display: flex;
            align-items: center;
        }
        
        .user-actions a {
            padding: 8px 12px;
            text-decoration: none;
            color: #505050;
            font-size: 14px;
            transition: color 0.3s ease;
        }
        
        .user-actions a:hover {
            color: #FB7299;
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            margin-left: 10px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .user-avatar:hover {
            transform: scale(1.1);
        }
        
        /* 主要内容区域 */
        .main-content {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }
        
        /* 页面标题 */
        .page-title {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .page-title .title-content {
            flex: 1;
        }
        
        .back-btn {
            background: #FB7299;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: background 0.3s ease;
        }
        
        .back-btn:hover {
            background: #e65a7f;
        }
        
        .page-title h1 {
            color: #333;
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .page-title .subtitle {
            color: #666;
            font-size: 14px;
        }
        
        /* 加载状态 */
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .loading i {
            font-size: 24px;
            margin-bottom: 10px;
            color: #FB7299;
        }
        
        /* 视频网格布局 */
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        /* 视频卡片样式 */
        .video-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .video-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .video-thumbnail {
            position: relative;
            width: 100%;
            height: 160px;
            overflow: hidden;
        }
        
        .video-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .video-card:hover .video-thumbnail img {
            transform: scale(1.05);
        }
        
        .video-duration {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .video-info {
            padding: 12px;
        }
        
        .video-title {
            font-size: 14px;
            font-weight: 500;
            color: #333;
            margin-bottom: 8px;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .video-meta {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 12px;
            color: #999;
        }
        
        .video-stats {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .video-stats span {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .up-info {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .up-avatar {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }
        
        .up-name {
            color: #666;
            font-size: 12px;
        }
        
        /* 分页控件 */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 30px;
            padding: 20px 0;
        }
        
        .pagination button {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            color: #666;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .pagination button:hover {
            border-color: #FB7299;
            color: #FB7299;
        }
        
        .pagination button.active {
            background: #FB7299;
            color: white;
            border-color: #FB7299;
        }
        
        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* 统计信息 */
        .stats-info {
            background: white;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            color: #666;
        }
        
        .stats-info .video-count {
            color: #FB7299;
            font-weight: 500;
        }
        
        /* 错误状态 */
        .error-message {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .error-message i {
            font-size: 48px;
            margin-bottom: 20px;
            color: #ccc;
        }
        
        .error-message h3 {
            margin-bottom: 10px;
            color: #333;
        }
        
        .error-message p {
            margin-bottom: 20px;
        }
        
        .retry-btn {
            background: #FB7299;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .retry-btn:hover {
            background: #e65a7f;
        }
    </style>
</head>
<body>
    <!-- 顶部导航栏 -->
    <header class="header">
        <div class="nav-container">
            <div class="logo">
                <div class="audio-wave">
                    <div class="wave-bar"></div>
                    <div class="wave-bar"></div>
                    <div class="wave-bar"></div>
                    <div class="wave-bar"></div>
                </div>
                <span>酷哩酷哩</span>
            </div>
            
            <nav class="main-nav">
                <a href="index.html">首页</a>
                <a href="anime.html">番剧</a>
                <a href="live.html">直播</a>
                <a href="game.html">游戏</a>
                <a href="vip.html">会员购</a>
                <a href="manga.html">漫画</a>
                <a href="esports.html">赛事</a>
            </nav>
            
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="搜索视频、番剧、UP主或AV号">
                <button class="search-btn" onclick="openSearch()">搜索</button>
            </div>
            
            <div class="user-actions">
                <a href="#" id="loginBtn">登录</a>
                <a href="#" id="registerBtn">注册</a>
                <img src="https://via.placeholder.com/32x32/00A1D6/FFFFFF?text=U" alt="用户头像" class="user-avatar" id="userAvatar" style="display: none;">
            </div>
        </div>
    </header>

    <!-- 主要内容区域 -->
    <div class="main-content">
        <!-- 页面标题 -->
        <div class="page-title">
            <div class="title-content">
                <h1 id="sectionTitle">更多视频</h1>
                <div class="subtitle" id="sectionSubtitle">发现更多精彩内容</div>
            </div>
            <a href="index.html" class="back-btn">
                <i class="fas fa-arrow-left"></i>
                返回首页
            </a>
        </div>
        
        <!-- 统计信息 -->
        <div class="stats-info" id="statsInfo" style="display: none;">
            <span>共找到 <span class="video-count" id="videoCount">0</span> 个视频</span>
            <span>分区：<span id="currentSection">推荐</span></span>
        </div>
        
        <!-- 视频内容区域 -->
        <div id="videoContainer">
            <div class="loading">
                <i class="fas fa-spinner fa-spin"></i>
                <p>正在加载视频...</p>
            </div>
        </div>
        
        <!-- 分页控件 -->
        <div class="pagination" id="pagination" style="display: none;">
            <button id="prevBtn" onclick="changePage(-1)">
                <i class="fas fa-chevron-left"></i> 上一页
            </button>
            <div id="pageNumbers"></div>
            <button id="nextBtn" onclick="changePage(1)">
                下一页 <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>

    <script>
        // 基础功能：获取URL参数
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                section: params.get('section') || 'recommend',
                page: parseInt(params.get('page')) || 1
            };
        }
        
        // 基础功能：打开搜索页面
        function openSearch() {
            window.open('search.html', '_blank');
        }
        
        // 基础功能：检查用户登录状态
        function checkUserStatus() {
            const user = JSON.parse(localStorage.getItem('user') || 'null');
            if (user) {
                document.getElementById('loginBtn').style.display = 'none';
                document.getElementById('registerBtn').style.display = 'none';
                document.getElementById('userAvatar').style.display = 'block';
                document.getElementById('userAvatar').src = user.avatar || 'https://via.placeholder.com/32x32/00A1D6/FFFFFF?text=U';
            }
        }
        
        // 全局变量
        let currentPage = 1;
        let totalPages = 1;
        let currentSection = 'recommend';
        let videos = [];
        
        // 分区配置
        const sectionConfig = {
            'recommend': {
                title: '热门推荐',
                subtitle: '发现更多热门视频',
                api: '/api/bilibili/recommend'
            },
            'music': {
                title: '音乐区',
                subtitle: '聆听更多音乐作品',
                api: '/api/bilibili/channel/3'
            },
            'dance': {
                title: '舞蹈区',
                subtitle: '欣赏更多舞蹈表演',
                api: '/api/bilibili/channel/129'
            },
            'game': {
                title: '游戏区',
                subtitle: '观看更多游戏视频',
                api: '/api/bilibili/channel/4'
            },
            'tech': {
                title: '科技区',
                subtitle: '探索更多科技内容',
                api: '/api/bilibili/channel/36'
            },
            'life': {
                title: '生活区',
                subtitle: '体验更多生活分享',
                api: '/api/bilibili/channel/160'
            },
            'kichiku': {
                title: '鬼畜区',
                subtitle: '享受更多鬼畜创作',
                api: '/api/bilibili/channel/119'
            }
        };
        
        // 页面加载时执行
        document.addEventListener('DOMContentLoaded', function() {
            checkUserStatus();
            loadVideos();
        });
        
        // 加载视频数据
        async function loadVideos() {
            const params = getUrlParams();
            currentSection = params.section;
            currentPage = params.page;
            
            // 设置页面标题
            const config = sectionConfig[currentSection] || sectionConfig['recommend'];
            document.getElementById('sectionTitle').textContent = config.title;
            document.getElementById('sectionSubtitle').textContent = config.subtitle;
            
            // 显示加载状态
            showLoading();
            
                         try {
                 // 调用API获取视频数据
                 console.log('正在调用API:', config.api);
                 const response = await fetch(config.api);
                 if (!response.ok) {
                     throw new Error(`HTTP error! status: ${response.status}`);
                 }
                 
                 const data = await response.json();
                 console.log('API响应数据:', data);
                 
                 if (data.success) {
                     // 根据API返回的数据结构获取视频列表
                     const videoData = data.videos || data.data || [];
                     videos = videoData;
                     console.log(`加载${currentSection}分区视频:`, videos.length, '个');
                     console.log('视频数据示例:', videos[0]);
                     renderVideos();
                     showPagination();
                 } else {
                     throw new Error(data.error || '数据格式错误');
                 }
             } catch (error) {
                 console.error('加载视频失败:', error);
                 showError(`加载失败: ${error.message}`);
             }
        }
        
        // 渲染视频列表
        function renderVideos() {
            const container = document.getElementById('videoContainer');
            
            if (!videos || videos.length === 0) {
                container.innerHTML = `
                    <div class="error-message">
                        <i class="fas fa-video-slash"></i>
                        <h3>暂无视频</h3>
                        <p>该分区暂时没有更多视频</p>
                        <button class="retry-btn" onclick="loadVideos()">重新加载</button>
                    </div>
                `;
                return;
            }
            
                         const videoHTML = videos.map(video => {
                 // 安全处理视频数据
                 const title = video.title || '未知标题';
                 const bvid = video.bvid || video.id || '';
                 const pic = video.pic || video.thumb || '';
                 const duration = video.duration || video.durationTime || 0;
                 const play = video.play || video.viewCount || 0;
                 const videoReview = video.video_review || 0;
                 const upic = video.upic || video.upAvatar || '';
                 const author = video.author || video.upName || '未知UP主';
                 
                 console.log('处理视频数据:', { title, bvid, pic, duration, play, videoReview, upic, author });
                
                return `
                    <div class="video-card" onclick="playVideo('${bvid}')">
                        <div class="video-thumbnail">
                            <img src="/proxy/image?url=${encodeURIComponent(pic)}" 
                                 alt="${title}" 
                                 onerror="this.src='https://via.placeholder.com/300x200/00A1D6/FFFFFF?text=Video'">
                            <div class="video-duration">${formatDuration(duration)}</div>
                        </div>
                        <div class="video-info">
                            <div class="video-title">${title}</div>
                            <div class="video-meta">
                                <div class="video-stats">
                                    <span><i class="fas fa-play"></i> ${formatViewCount(play)}</span>
                                    <span><i class="fas fa-comment"></i> ${formatViewCount(videoReview)}</span>
                                </div>
                                <div class="up-info">
                                    <img src="/proxy/image?url=${encodeURIComponent(upic)}" 
                                         alt="${author}" 
                                         class="up-avatar"
                                         onerror="this.src='https://via.placeholder.com/20x20/00A1D6/FFFFFF?text=U'">
                                    <span class="up-name">${author}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = `
                <div class="video-grid">
                    ${videoHTML}
                </div>
            `;
            
            // 显示统计信息
            document.getElementById('videoCount').textContent = videos.length;
            document.getElementById('currentSection').textContent = sectionConfig[currentSection]?.title || '未知分区';
            document.getElementById('statsInfo').style.display = 'flex';
            
            console.log(`成功渲染${videos.length}个视频卡片`);
        }
        
        // 显示加载状态
        function showLoading() {
            document.getElementById('videoContainer').innerHTML = `
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>正在加载视频...</p>
                </div>
            `;
            document.getElementById('pagination').style.display = 'none';
            document.getElementById('statsInfo').style.display = 'none';
        }
        
        // 显示错误状态
        function showError(message) {
            document.getElementById('videoContainer').innerHTML = `
                <div class="error-message">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>加载失败</h3>
                    <p>${message}</p>
                    <button class="retry-btn" onclick="loadVideos()">重新加载</button>
                </div>
            `;
            document.getElementById('pagination').style.display = 'none';
            document.getElementById('statsInfo').style.display = 'none';
        }
        
        // 显示分页控件
        function showPagination() {
            // 这里可以根据实际数据量计算总页数
            // 暂时隐藏分页，因为API返回的是固定数量的视频
            document.getElementById('pagination').style.display = 'none';
        }
        
        // 切换页面
        function changePage(delta) {
            const newPage = currentPage + delta;
            if (newPage >= 1 && newPage <= totalPages) {
                currentPage = newPage;
                const url = new URL(window.location);
                url.searchParams.set('page', newPage);
                window.history.pushState({}, '', url);
                loadVideos();
            }
        }
        
        // 播放视频
        function playVideo(bvid) {
            window.open(`play.html?bvid=${bvid}&source=bilibili`, '_blank');
        }
        
        // 格式化时长
        function formatDuration(seconds) {
            if (!seconds) return '00:00';
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        // 格式化播放量
        function formatViewCount(count) {
            if (!count) return '0';
            if (count >= 10000) {
                return (count / 10000).toFixed(1) + '万';
            }
            return count.toString();
        }
    </script>
</body>
</html>
