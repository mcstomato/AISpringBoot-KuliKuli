# AI SpringBoot 后端项目

## 项目简介
这是一个基于Spring Boot的视频分享平台后端项目，集成了用户管理系统、视频管理、Banner管理等功能。使用H2文件数据库进行数据持久化存储。

## 项目结构
```
backend/
├── src/
│   └── main/
│       ├── java/com/example/demo/
│       │   ├── Application.java          # 主启动类
│       │   ├── controller/               # 控制器层
│       │   │   ├── UserController.java   # 用户管理控制器
│       │   │   ├── VideoController.java  # 视频管理控制器
│       │   │   ├── BannerController.java # Banner管理控制器
│       │   │   ├── ImageProxyController.java # 图片代理控制器
│       │   │   └── WelcomeController.java # 欢迎页面控制器
│       │   ├── service/                  # 服务层
│       │   │   └── WelcomeService.java   # 欢迎页面服务
│       │   ├── dao/                      # 数据访问层
│       │   │   ├── UserRepository.java   # 用户数据访问
│       │   │   ├── BilibiliVideoRepository.java # 视频数据访问
│       │   │   ├── BannerMessageRepository.java # Banner数据访问
│       │   │   └── PlaceholderDao.java   # 占位符数据访问
│       │   ├── model/                    # 实体类
│       │   │   ├── User.java             # 用户实体
│       │   │   ├── BilibiliVideo.java    # 视频实体
│       │   │   └── BannerMessage.java    # Banner实体
│       │   └── config/                   # 配置类
│       │       ├── CorsConfig.java       # 跨域配置
│       │       └── DataMigrationRunner.java # 数据迁移配置
│       └── resources/
│           ├── application.properties    # 应用配置
│           ├── schema.sql               # 数据库结构
│           ├── data.sql                 # 初始数据
│           ├── bilibili_videos.sql      # B站视频数据
│           └── static/                  # 静态资源
│               ├── index.html           # 主页
│               ├── auth.html            # 登录注册页
│               ├── profile.html         # 个人主页
│               ├── video.html           # 视频播放页
│               ├── play.html            # 播放器页面
│               └── test.html            # 测试页面
├── data/                                # H2数据库文件
│   ├── demo_db.mv.db                    # 主数据库文件
│   └── demo_db.trace.db                 # 数据库日志文件
├── pom.xml                              # Maven配置
└── README.md                            # 项目说明
```

## 环境要求
- Java 1.8+
- Maven 3.6+
- H2数据库 (文件模式)

## 构建和运行

### 使用批处理文件（推荐）
```bash
# 在项目根目录运行
运行项目.bat
```

### 使用PowerShell
```powershell
# 进入后端目录
cd backend

# 编译项目
& "D:\apache-maven-3.9.9\bin\mvn.cmd" clean compile

# 运行项目
& "D:\apache-maven-3.9.9\bin\mvn.cmd" spring-boot:run -DskipTests
```

### 使用命令行
```bash
# 进入后端目录
cd backend

# 编译项目
mvn clean compile

# 运行项目
mvn spring-boot:run -DskipTests
```

### 打包部署
```bash
# 打包为JAR文件
mvn clean package -DskipTests

# 运行JAR文件
java -jar target/demo-0.0.1-SNAPSHOT.jar
```

## API接口

### 用户管理接口
- `POST /api/users/register` - 用户注册
  - 参数: `login_account`, `nickname`, `password`, `confirm_password`
  - 功能: 注册新用户，自动设置加入时间
- `POST /api/users/login` - 用户登录
  - 参数: `login_account`, `password`
  - 功能: 验证用户身份并返回用户信息
- `POST /api/users/check-status` - 检查用户状态
  - 参数: `login_account`
  - 功能: 验证用户是否在数据库中存在
- `POST /api/users/update` - 更新用户资料
  - 参数: `login_account`, `nickname`, `password`, `bio`, `avatar_url`
  - 功能: 更新用户个人信息

### 视频相关接口
- `GET /api/videos` - 获取视频列表
- `GET /api/videos/{id}` - 获取单个视频
- `POST /api/videos` - 添加视频
- `PUT /api/videos/{id}` - 更新视频
- `DELETE /api/videos/{id}` - 删除视频

### Banner相关接口
- `GET /api/banners` - 获取Banner列表
- `POST /api/banners` - 添加Banner
- `PUT /api/banners/{id}` - 更新Banner
- `DELETE /api/banners/{id}` - 删除Banner

### 图片代理接口
- `GET /api/proxy/image` - 图片代理服务

## 数据库配置
- **类型**: H2文件数据库
- **数据库文件**: `./data/demo_db.mv.db`
- **控制台地址**: http://localhost:8080/h2-console
- **JDBC URL**: `jdbc:h2:file:./data/demo_db`
- **用户名**: `sa`
- **密码**: (留空)
- **初始化模式**: `always` (每次启动都会执行schema.sql和data.sql)

## 数据库表结构

### users表（用户表）
```sql
CREATE TABLE users (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1000) PRIMARY KEY,
  login_account VARCHAR(100) NOT NULL UNIQUE,
  nickname VARCHAR(100) NOT NULL,
  password VARCHAR(255) NOT NULL,
  avatar_url VARCHAR(500),
  age INT,
  bio TEXT,
  join_date DATE DEFAULT CURRENT_DATE,
  video_count INT DEFAULT 0,
  follower_count INT DEFAULT 0,
  following_count INT DEFAULT 0
);
```

### bilibili_videos表（视频表）
```sql
CREATE TABLE bilibili_videos (
  id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  title VARCHAR(500),
  up_name VARCHAR(100),
  up_face_url VARCHAR(500),
  view_count INT DEFAULT 0,
  danmaku_count INT DEFAULT 0,
  duration_time VARCHAR(20),
  aid BIGINT,
  bvid VARCHAR(20),
  cid BIGINT,
  publish_time DATETIME,
  cover_url VARCHAR(500),
  video_url VARCHAR(500),
  embed_url TEXT,
  fetch_time DATETIME,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## 前端集成
- 前端项目位于 `../frontend/` 目录
- 前端默认运行在 http://localhost:3000
- 已配置CORS支持跨域访问

## 功能特性

### 用户系统
- ✅ 用户注册与登录
- ✅ 用户资料管理
- ✅ 头像上传（URL方式）
- ✅ 个人主页展示
- ✅ 用户状态验证
- ✅ 自动加入时间记录

### 安全特性
- ✅ 登录状态实时验证
- ✅ 用户数据完整性检查
- ✅ 密码确认验证
- ✅ 登录账号唯一性验证
- ✅ 中文字符过滤

### 数据管理
- ✅ H2文件数据库持久化
- ✅ 自动数据库初始化
- ✅ 视频数据自动重载
- ✅ 用户数据保留更新

## 前端页面
- **主页** (`/`): 视频展示和用户登录状态
- **登录注册页** (`/auth.html`): 用户认证界面
- **个人主页** (`/profile.html`): 用户资料展示和编辑
- **视频播放页** (`/video.html`): 视频播放界面
- **播放器页面** (`/play.html`): 独立播放器

## 开发说明

### 数据库初始化
- 项目启动时自动执行`schema.sql`创建表结构
- 自动执行`data.sql`插入初始数据
- `bilibili_videos`表每次启动都会清空并重新加载

### 用户ID规则
- 用户ID从1000开始自增
- 确保ID的唯一性和连续性

### 文件存储
- 数据库文件存储在`./data/`目录
- 静态资源存储在`src/main/resources/static/`目录

## 注意事项
- 确保8080端口未被占用
- 数据库文件会自动创建，无需手动初始化
- 用户数据会持久化保存，重启后不会丢失
- 视频数据每次启动会重新加载，确保数据最新
- 支持跨域访问，前端可直接调用API

## 故障排除
1. **端口占用**: 使用`netstat -ano | findstr :8080`检查端口占用
2. **数据库锁定**: 停止所有Java进程后重新启动
3. **编译错误**: 确保Java版本和Maven版本兼容
4. **数据丢失**: 检查`./data/`目录下的数据库文件是否存在

## 项目完成度

| A | B | C |
|---|---|---|
| 1 | A | X |
|   | B | X |
|   | C | X |
| 2 | D | X |
|   | E | X |
|   | F | X |
| 3 | G | X |
|   | H | X |
|   | F | X |